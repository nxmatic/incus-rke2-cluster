== Flux Instance kpt Package

This package vendors the upstream Flux Instance Helm chart via the
`+render-helm-chart+` KRM function. Like the Flux Operator package, the
upstream copy only carries sample setters so each cluster can configure
its release name, namespace, and GitRepository sync details downstream
before rendering.

=== Usage

[arabic]
. Fetch the package into the downstream/state repository. Replace the
`<cluster>/...` path with whatever directory you render
today (for example `fleet/bioskop/flux-instance`) until Porch
`PackageVariant` resources are in place:

`+@codebase bash kpt pkg get https://github.com/nxmatic/incus-rke2-cluster.git/kpt/system/flux-instance \
    <cluster>/system/flux-instance+`

. Commit that untouched copy immediately so you have a clean restore
point before running the render pipeline; if `kpt fn render` deletes or
reshapes files you still need, a quick
`@codebase bash git restore --staged --worktree <cluster>/system/flux-instance`
(swap in your actual downstream path) returns the tree to the pre-render
state.

. Update `+flux-instance-setters.yaml+` (or replace it with a
SOPS-encrypted Secret) to match the environment. Typical edits include
the Flux release namespace, chart version, Flux distribution artifact,
and the GitRepository URL/branch/path that Flux should reconcile.
. Run the render pipeline so the `FluxInstance` object lands under the
same directory. If the Helm render removes any local-config files,
restore them before staging:

`+@codebase bash git restore --staged --worktree <cluster>/system/flux-instance+`
(again, point this at your real downstream directory).

After that, commit the rendered manifests so your GitOps agent (Flux,
Config Sync, etc.) can apply them:

`+@codebase bash kpt fn render <cluster>/system/flux-instance+`
(or the actual path such as `fleet/<cluster>/flux-instance`).

. Apply the rendered resources to the cluster. If you want to test
changes via Helm directly before committing, the source chart can also
be installed with:

`+@codebase bash helm upgrade --install flux-instance oci://ghcr.io/controlplaneio-fluxcd/charts/flux-instance \
    --namespace flux-system \
    --create-namespace+`

Remember to keep `+render-helm-chart.yaml+` in sync with upstream
releases whenever the Flux Instance chart is upgraded.
