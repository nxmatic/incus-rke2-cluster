apiVersion: cilium.io/v2
kind: CiliumBGPClusterConfig
metadata:
  name: bgp-cluster-config
spec:
  nodeSelector:
    matchLabels:
      node-role.kubernetes.io/control-plane: ""
  bgpInstances:
  - name: "control-plane-bgp"
    localASN: 65001 # kpt-set: ${bgp-local-asn}
    peers:
    - name: "gateway-peer"
      peerASN: 65000 # kpt-set: ${bgp-peer-asn}
      peerAddress: 10.80.8.1 # kpt-set: ${node-gateway-ip}
      peerConfigRef:
        name: "cilium-peer"
---
apiVersion: cilium.io/v2
kind: CiliumBGPAdvertisement
metadata:
  name: control-plane-advertisement
spec:
  advertisements:
  - advertisementType: "Service"
    service:
      addresses:
      - ExternalIP
      - LoadBalancerIP
    selector:
      matchLabels:
        io.cilium/lb-ipam: "load-balancers"
  - advertisementType: "PodCIDR"
