---
apiVersion: v1
data:
  agent-sync.sh: |-
    #!/usr/bin/env -S bash -exuo pipefail
    apk add --no-cache kubectl
    AUTHKEY=$(kubectl get secret headscale-client-auth -n "${HEADSCALE_NAMESPACE}" -o jsonpath='{.data.authkey}' | base64 -d)
    kubectl create secret generic headplane-agent-auth \
      -n "${HEADPLANE_NAMESPACE}" \
      --from-literal=preauthkey="${AUTHKEY}" \
      --dry-run=client -o yaml | kubectl apply -f -
kind: ConfigMap
metadata:
  annotations:
    internal.kpt.dev/upstream-identifier: '|ConfigMap|${headplane-namespace}|headplane-agent-sync-script'
    kpt.dev/package-layer: mesh
    kpt.dev/package-name: headplane
  name: headplane-agent-sync-script
  namespace: ${headplane-namespace}
