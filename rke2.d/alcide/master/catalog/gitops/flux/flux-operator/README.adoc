== Flux Operator kpt Package

This package vendors the upstream Flux Operator Helm chart via the
`+render-helm-chart+` KRM function. The upstream copy only carries
example setters so each cluster can customize the release name,
namespace, and chart version downstream before rendering.

=== Usage

[arabic]
. Fetch the package into the downstream/state repository. Until Porch
owns `PackageVariant` resources in this cluster, substitute whatever
path you actually commit to (for example
`fleet/bioskop/flux-operator`):

`+@codebase bash kpt pkg get ../system/flux-operator ./<cluster>/system/flux-operator+`

. Commit that pristine copy so you can always roll back to the upstream
layout before (re)rendering. If a future `kpt fn render` removes files
you still need, you can immediately undo the change with
`@codebase bash git restore --staged --worktree <cluster>/system/flux-operator`
(swap the path for your real tree, e.g.
`fleet/bioskop/flux-operator`) or target specific filenames as needed.

[arabic]
. Update `+setters.yaml+` (or replace it with a
SOPS-encrypted Secret) to match the environment. Typical edits include
the namespace, chart version, and release name.
. Run the render pipeline so the Helm payload materializes inside the
same directory. Before staging anything, restore any files the render
operation deleted (for example the setters or `render-helm-chart.yaml`)
with:

`+@codebase bash git restore --staged --worktree <cluster>/system/flux-operator+`
(again, replace the path with your actual downstream location).

Once the package tree looks correct, commit the rendered manifests so
your GitOps agent (Flux, Config Sync, etc.) can apply them:

`+@codebase bash kpt fn render <cluster>/system/flux-operator+`
(or the equivalent `fleet/<cluster>/flux-operator` path you keep
rendered in git).

[arabic]
. Apply the rendered resources to the cluster. If you want to test
changes via Helm directly before committing, the source chart can also
be installed with:

`+@codebase bash helm install flux-operator oci://ghcr.io/controlplaneio-fluxcd/charts/flux-operator \   --namespace flux-system \   --create-namespace+`

Remember to keep the packaged chart payload (`+render-helm-chart.yaml+`)
in sync with upstream releases whenever the Flux Operator is upgraded.
