apiVersion: batch/v1
kind: Job
metadata: # kpt-merge: ${envoy-gateway-namespace}/envoy-gateway-installer
  name: envoy-gateway-installer
  namespace: ${envoy-gateway-namespace} # kpt-set: ${envoy-gateway-namespace}
  annotations:
    internal.kpt.dev/upstream-identifier: 'batch|Job|${envoy-gateway-namespace}|envoy-gateway-installer'
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      serviceAccountName: envoy-gateway-installer
      restartPolicy: OnFailure
      containers:
      - name: installer
        image: alpine/k8s:1.29.8
        command:
        - sh
        - /scripts/install.sh
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
            ephemeral-storage: 128Mi
          limits:
            cpu: 200m
            memory: 256Mi
            ephemeral-storage: 256Mi
        volumeMounts:
        - name: installer-script
          mountPath: /scripts
          readOnly: true
        env:
        - name: ENVOY_GATEWAY_VERSION
          value: ${envoy-gateway-version} # kpt-set: ${envoy-gateway-version}
        - name: ENVOY_GATEWAY_NAMESPACE
          value: ${envoy-gateway-namespace} # kpt-set: ${envoy-gateway-namespace}
      volumes:
      - name: installer-script
        configMap:
          name: envoy-gateway-installer-script
          defaultMode: 0755
  backoffLimit: 3
