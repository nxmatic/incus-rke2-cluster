= Documentation Guide

The Incus RKE2 cluster documentation is authored in AsciiDoc and rendered locally. Diagrams are produced with PlantUML and checked into version control as SVGs so published docs never depend on an external diagram rendering service.

== Prerequisites

All required tooling (Asciidoctor, PlantUML, Graphviz, Node.js) lives in the docs Flox environment. Activate it before building anything:

[source,shell]
----
# @codebase
flox activate --dir docs
----

== Workflow Overview

1. **Edit prose**: update the `.adoc` files under `docs/` as needed.
2. **Update diagrams**: modify the `.puml` sources, then regenerate the SVGs so they remain committed alongside the prose.
3. **Preview locally**: use the AsciiDoc VS Code extension (or any editor with built-in preview) to render the pages.

=== Generating PlantUML assets

The Makefile layer encapsulates PlantUML invocations and stores outputs in `docs/images/`. Regenerate everything after changing any `.puml` source:

[source,shell]
----
# @codebase
make diagrams@plantuml   # alias: make docs-diagrams
----

Only committed SVGs under `docs/images/` should be referenced from `.adoc` files via `image::images/<name>.svg[]`.

=== Previewing in VS Code

After activating the docs Flox environment, open the repository in VS Code, install the AsciiDoc extension, and use the built-in preview (`AsciiDoc: Open Preview to the Side`). PlantUML diagrams resolve immediately because the SVGs are committed under `docs/images/`.

=== Repository layout highlights

* `docs/images/` – committed SVG artifacts generated from PlantUML.
* `docs/*.puml` – system and C4 diagrams that feed the SVGs.
* `docs/.asciidoctorconfig` – shared Asciidoctor attributes (table of contents, syntax highlighting, etc.).
* `make diagrams@plantuml` – render/update every committed SVG used by the docs.

=== Adding new diagrams

1. Create a `.puml` file under `docs/` (or extend an existing one).
2. Reference the generated SVG in the relevant `.adoc` file using `image::` syntax.
3. Run `make diagrams@plantuml` and commit both the updated `.puml` and resulting SVG in `docs/images/`.
4. Rebuild the HTML to validate the rendered output locally.

Keeping SVGs checked in ensures reviewers and automation can diff both prose and visuals without relying on remote services.
